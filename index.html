<script>
const products = [
    {id:1,name:"iPhone 17 Pro Max",price:45990000,originalPrice:47990000,category:"phone",image:"https://cdn.xtmobile.vn/vnt_upload/product/09_2025/thumbs/600_ip17pm_1.png",description:"ƒêi·ªán tho·∫°i th√¥ng minh cao c·∫•p v·ªõi chip A19 Pro"},
    {id:2,name:"iPhone 15 Pro Max",price:29990000,originalPrice:34990000,category:"phone",image:"https://cdn2.cellphones.com.vn/insecure/rs:fill:358:358/q:90/plain/https://cellphones.com.vn/media/catalog/product/i/p/iphone-15-pro-max_3.png",description:"ƒêi·ªán tho·∫°i th√¥ng minh cao c·∫•p v·ªõi chip A17 Pro"},
    {id:3,name:"Samsung Galaxy S25 Ultra 12GB 256GB",price:26990000,originalPrice:31990000,category:"phone",image:"https://cdn2.cellphones.com.vn/insecure/rs:fill:0:358/q:90/plain/https://cellphones.com.vn/media/catalog/product/d/i/dien-thoai-samsung-galaxy-s25-ultra_1__3.png",description:"Flagship Android v·ªõi S Pen v√† camera 200MP"},
    {id:4,name:"ZTE Nubia Red Magic 10S Pro Plus",price:21650000,originalPrice:23990000,category:"phone",image:"https://cdn2.fptshop.com.vn/unsafe/1920x0/filters:format(webp):quality(75)/nubia_red_magic_10_pro_dat_diem_so_antutu_kich_tran_dinh_noc_bay_phap_phoi_1_073cfe39da.jpg",description:"Flagship Gaming m·∫°nh nh·∫•t th·∫ø gi·ªõi"},
    {id:5,name:"MacBook Air M3",price:28990000,originalPrice:32990000,category:"laptop",image:"https://cdn2.cellphones.com.vn/x/media/catalog/product/m/a/macbook-air-m3-13-inch-2024_1__4.png",description:"Laptop si√™u m·ªèng v·ªõi chip M3 m·∫°nh m·∫Ω"},
    {id:6,name:"Dell XPS 13",price:24990000,originalPrice:29990000,category:"laptop",image:"https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=400&h=400&fit=crop&crop=center",description:"Laptop cao c·∫•p cho doanh nh√¢n"},
    {id:7,name:"Samsung QLED 65 inch",price:18990000,originalPrice:24990000,category:"tv",image:"https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?w=400&h=400&fit=crop&crop=center",description:"Smart TV 4K v·ªõi c√¥ng ngh·ªá QLED"},
    {id:8,name:"LG OLED 55 inch",price:16990000,originalPrice:21990000,category:"tv",image:"https://images.unsplash.com/photo-1567690187548-f07b1d7bf5a9?w=400&h=400&fit=crop&crop=center",description:"TV OLED v·ªõi ch·∫•t l∆∞·ª£ng h√¨nh ·∫£nh tuy·ªát v·ªùi"},
    {id:9,name:"T·ªß l·∫°nh Samsung Inverter",price:12990000,originalPrice:15990000,category:"fridge",image:"https://images.unsplash.com/photo-1571175443880-49e1d25b2bc5?w=400&h=400&fit=crop&crop=center",description:"T·ªß l·∫°nh 2 c√°nh ti·∫øt ki·ªám ƒëi·ªán"},
    {id:10,name:"T·ªß l·∫°nh LG Side by Side",price:19990000,originalPrice:24990000,category:"fridge",image:"https://www.lg.com/content/dam/channel/wcms/vn/rf/lsi63blma/gallery/2010-1.jpg/jcr:content/renditions/thum-1600x1062.jpeg",description:"T·ªß l·∫°nh c·ª≠a ƒë√¥i cao c·∫•p"},
    {id:11,name:"L√≤ vi s√≥ng Panasonic",price:2990000,originalPrice:3990000,category:"microwave",image:"https://images.unsplash.com/photo-1574269909862-7e1d70bb8078?w=400&h=400&fit=crop&crop=center",description:"L√≤ vi s√≥ng 25L v·ªõi nhi·ªÅu ch·ª©c nƒÉng"},
    {id:12,name:"L√≤ vi s√≥ng Sharp Inverter",price:3990000,originalPrice:4990000,category:"microwave",image:"https://images.unsplash.com/photo-1585659722983-3a675dabf23d?w=400&h=400&fit=crop&crop=center",description:"L√≤ vi s√≥ng Inverter ti·∫øt ki·ªám ƒëi·ªán"},
    {id:13,name:"AirPods Pro 2",price:5990000,originalPrice:6990000,category:"accessories",image:"https://cdn2.cellphones.com.vn/insecure/rs:fill:0:358/q:90/plain/https://cellphones.com.vn/media/catalog/product/a/i/airpods_pro_2_sep24_pdp_image_position_2__vn-vi.jpg",description:"Tai nghe kh√¥ng d√¢y ch·ªëng ·ªìn"},
    {id:14,name:"S·∫°c d·ª± ph√≤ng Anker 20000mAh",price:1290000,originalPrice:1590000,category:"accessories",image:"https://cdn2.cellphones.com.vn/insecure/rs:fill:358:358/q:90/plain/https://cellphones.com.vn/media/catalog/product/p/i/pin-sac-du-phong-anker-prime-a1336-20000mah-200w_1_.png",description:"Pin s·∫°c d·ª± ph√≤ng dung l∆∞·ª£ng cao"}
];

let cart = [];

function formatCurrency(amount){ return amount.toLocaleString('vi-VN')+'ƒë'; }

function renderProducts(productsToRender=products){
    const grid=document.getElementById('productGrid');
    grid.innerHTML='';
    productsToRender.forEach(p=>{
        const discount=Math.round((1-p.price/p.originalPrice)*100);
        const card=document.createElement('div');
        card.className='product-card bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300';
        card.innerHTML=`
            <div class="relative">
                <div class="h-48 bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center overflow-hidden">
                    <img src="${p.image}" alt="${p.name}" class="w-full h-full object-contain hover:scale-105 transition-transform duration-300"
                        onerror="this.src=''; this.alt='H√¨nh ·∫£nh kh√¥ng t·∫£i'; this.style.display='none'; this.parentElement.innerHTML='<div class=\\'text-6xl text-gray-400\\'>üì¶</div>';"/>
                </div>
                <div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-sm font-bold">
                    -${discount}%
                </div>
            </div>
            <div class="p-4">
                <h3 class="font-bold text-lg mb-2 text-gray-800">${p.name}</h3>
                <p class="text-gray-600 text-sm mb-3">${p.description}</p>
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <span class="text-red-500 font-bold text-xl">${formatCurrency(p.price)}</span>
                        <span class="text-gray-400 line-through text-sm ml-2">${formatCurrency(p.originalPrice)}</span>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button onclick="addToCart(${p.id})" class="flex-1 bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-all font-medium">
                        <i class="fas fa-cart-plus mr-2"></i>Th√™m v√†o gi·ªè
                    </button>
                    <button onclick="buyNow(${p.id})" class="flex-1 bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-all font-medium">
                        Mua ngay
                    </button>
                </div>
            </div>
        `;
        grid.appendChild(card);
    });
}

function filterProducts(category){
    const filtered=category==='all'?products:products.filter(p=>p.category===category);
    renderProducts(filtered);
    document.querySelectorAll('.nav-item').forEach(item=>item.classList.remove('active','bg-green-100'));
    event.target.classList.add('active','bg-green-100');
}

function addToCart(id){
    const p=products.find(x=>x.id===id);
    const item=cart.find(x=>x.id===id);
    if(item)item.quantity+=1;
    else cart.push({...p,quantity:1});
    updateCartUI();
    alert('ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè!');
}

function buyNow(id){ addToCart(id); toggleCart(); }

function updateCartUI(){
    const cartCount=document.getElementById('cartCount');
    const cartItems=document.getElementById('cartItems');
    const cartTotal=document.getElementById('cartTotal');
    const totalItems=cart.reduce((sum,i)=>sum+i.quantity,0);
    const totalPrice=cart.reduce((sum,i)=>sum+i.price*i.quantity,0);
    cartCount.textContent=totalItems;
    cartTotal.textContent=formatCurrency(totalPrice);
    if(cart.length===0) cartItems.innerHTML='<p class="text-gray-500 text-center py-8">Gi·ªè h√†ng tr·ªëng</p>';
    else cartItems.innerHTML=cart.map(item=>`
        <div class="flex items-center justify-between p-4 border rounded-lg">
            <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden">
                    <img src="${item.image}" alt="${item.name}" class="w-full h-full object-contain"
                        onerror="this.src=''; this.alt='H√¨nh ·∫£nh kh√¥ng t·∫£i'; this.style.display='none'; this.parentElement.innerHTML='<div class=\\'text-2xl text-gray-400\\'>üì¶</div>';"/>
                </div>
                <div>
                    <h4 class="font-medium">${item.name}</h4>
                    <p class="text-red-500 font-bold">${formatCurrency(item.price)}</p>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <button onclick="updateQuantity(${item.id},-1)" class="bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center"><i class="fas fa-minus text-sm"></i></button>
                <span class="w-8 text-center">${item.quantity}</span>
                <button onclick="updateQuantity(${item.id},1)" class="bg-gray-200 hover:bg-gray-300 w-8 h-8 rounded-full flex items-center justify-center"><i class="fas fa-plus text-sm"></i></button>
                <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700 ml-2"><i class="fas fa-trash"></i></button>
            </div>
        </div>
    `).join('');
}

function updateQuantity(id,change){
    const item=cart.find(x=>x.id===id);
    if(item){ item.quantity+=change; if(item.quantity<=0) removeFromCart(id); else updateCartUI(); }
}

function removeFromCart(id){ cart=cart.filter(x=>x.id!==id); updateCartUI(); }

function toggleLogin(){ document.getElementById('loginModal').classList.toggle('hidden'); }
function toggleCart(){ document.getElementById('cartModal').classList.toggle('hidden'); }

function openCheckout(){
    if(cart.length===0){ alert('Gi·ªè h√†ng tr·ªëng!'); return; }
    toggleCart();
    document.getElementById('checkoutPopup').style.display='block';
}
function closeCheckout(){ document.getElementById('checkoutPopup').style.display='none'; }

document.getElementById('checkoutForm').addEventListener('submit',function(e){
    e.preventDefault();
    let data=new FormData(this);
    let msg=`ƒê∆°n h√†ng m·ªõi:\nH·ªç t√™n: ${data.get('name')}\nSƒêT: ${data.get('phone')}\nƒê·ªãa ch·ªâ: ${data.get('address')}\nThanh to√°n: ${data.get('payment')}\nS·∫£n ph·∫©m:\n`+
        cart.map(p=>`- ${p.name} x${p.quantity}`).join('\n');
    fetch('https://api.telegram.org/bot8442471639:AAGDomAwO9dEFBxgjx6tM4kprj0OzCyY1rw/sendMessage?chat_id=5979711401&text=' + encodeURIComponent(msg))
        .then(res=>res.json())
        .then(()=>{ alert('ƒê·∫∑t h√†ng th√†nh c√¥ng!'); cart=[]; updateCartUI(); closeCheckout(); });
});

// Search
document.getElementById('searchInput').addEventListener('input',function(e){
    let term=e.target.value.toLowerCase();
    renderProducts(products.filter(p=>p.name.toLowerCase().includes(term) || p.description.toLowerCase().includes(term)));
});

document.addEventListener('DOMContentLoaded',()=>{
    renderProducts();
    updateCartUI();
});

// Close modals by clicking outside
window.addEventListener('click',function(e){
    if(e.target.id==='loginModal') toggleLogin();
    if(e.target.id==='cartModal') toggleCart();
    if(e.target.id==='checkoutPopup') closeCheckout();
});
</script>
